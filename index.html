<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCA Project Allocation | Admin Console</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts: Outfit (Modern Headings) & Inter (UI) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- jsPDF and AutoTable -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Inter"', 'sans-serif'],
                        heading: ['"Outfit"', 'sans-serif'],
                    },
                    colors: {
                        dark: {
                            950: '#09090b', // Zinc 950
                            900: '#18181b', // Zinc 900
                            800: '#27272a', // Zinc 800
                            700: '#3f3f46', // Zinc 700
                            border: '#27272a',
                        },
                        brand: {
                            500: '#6366f1', // Indigo
                            600: '#4f46e5',
                            glow: 'rgba(99, 102, 241, 0.15)'
                        }
                    },
                    backgroundImage: {
                        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
                    }
                }
            }
        }
    </script>

    <style>
        body { 
            background-color: #09090b;
            color: #e4e4e7;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #09090b; }
        ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #3f3f46; }

        /* Animation Utilities */
        .fade-in-up { animation: fadeInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(10px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        /* Glass / Border Utilities */
        .glass-panel {
            background: rgba(24, 24, 27, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
    </style>
</head>
<body class="min-h-screen antialiased selection:bg-brand-500 selection:text-white">

    <!-- Navbar -->
    <nav class="sticky top-0 z-50 glass-panel border-b-0 border-b-dark-border">
        <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
            
            <!-- Logo Area -->
            <div class="flex items-center gap-4">
                <!-- Custom Geometric SVG Logo -->
                <div class="relative w-10 h-10 flex items-center justify-center">
                    <div class="absolute inset-0 bg-brand-500 rounded-xl opacity-20 blur-md"></div>
                    <svg class="relative w-10 h-10 text-white" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 5L32.9904 12.5V27.5L20 35L7.00962 27.5V12.5L20 5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M20 15V25" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M15 20H25" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="20" cy="20" r="2" fill="currentColor"/>
                        <circle cx="20" cy="5" r="2" fill="currentColor" class="text-brand-500"/>
                        <circle cx="32.99" cy="27.5" r="2" fill="currentColor" class="text-brand-500"/>
                        <circle cx="7.01" cy="27.5" r="2" fill="currentColor" class="text-brand-500"/>
                    </svg>
                </div>
                
                <div class="flex flex-col">
                    <h1 class="font-heading font-bold text-xl tracking-tight text-white leading-none">
                        Allocation<span class="text-brand-500">Console</span>
                    </h1>
                    <span class="text-[10px] font-medium text-zinc-500 uppercase tracking-widest mt-1">MCA Dept • 2025-26</span>
                </div>
            </div>

            <!-- Status Indicator -->
            <div class="hidden md:flex items-center gap-2 px-3 py-1.5 rounded-full bg-dark-800 border border-dark-700">
                <span class="relative flex h-2 w-2">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                </span>
                <span class="text-xs font-medium text-zinc-400">System Active</span>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-6 py-12 space-y-12">
        
        <!-- Control Bar -->
        <div class="relative overflow-hidden rounded-2xl bg-dark-900 border border-dark-800 p-8 shadow-2xl">
            <!-- Subtle Grid Background -->
            <div class="absolute inset-0 opacity-[0.03]" style="background-image: linear-gradient(#fff 1px, transparent 1px), linear-gradient(90deg, #fff 1px, transparent 1px); background-size: 20px 20px;"></div>
            
            <div class="relative flex flex-col md:flex-row items-center justify-between gap-8">
                <div class="space-y-2 max-w-xl">
                    <h2 class="font-heading text-3xl font-semibold text-white">Project Guide Distribution</h2>
                    <p class="text-zinc-400 font-light leading-relaxed">
                        Algorithmically distribute Final Year MCA students (Roll 1-60) to faculty guides based on predefined capacity constraints.
                    </p>
                </div>

                <div class="flex items-center gap-4">
                    <button id="allocateBtn" onclick="handleAllocate()" class="group relative inline-flex items-center justify-center h-12 px-8 font-medium transition-all duration-200 bg-white text-zinc-950 rounded-lg hover:bg-zinc-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-zinc-500 focus:ring-offset-dark-900">
                        <div class="absolute inset-0 rounded-lg ring-1 ring-inset ring-black/10"></div>
                        <span id="btnIcon" class="mr-2 transition-transform group-hover:rotate-180">
                            <!-- Refresh CW Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                        </span>
                        <span id="allocateBtnText">Run Allocation</span>
                    </button>

                    <button id="downloadBtn" onclick="handleDownloadPDF()" class="hidden inline-flex items-center justify-center h-12 px-6 font-medium text-zinc-300 transition-all duration-200 bg-dark-800 border border-dark-700 rounded-lg hover:bg-dark-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-dark-700 focus:ring-offset-dark-900">
                        <!-- Download Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="flex flex-col items-center justify-center py-24 text-center rounded-2xl border border-dashed border-dark-800 bg-dark-900/50">
            <div class="w-16 h-16 mb-6 rounded-2xl bg-dark-800 flex items-center justify-center">
                <svg class="w-8 h-8 text-zinc-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                </svg>
            </div>
            <h3 class="font-heading text-xl text-white font-medium">Awaiting Input</h3>
            <p class="text-zinc-500 mt-2 max-w-sm">System is ready. Initialize the allocation sequence to generate guide assignments.</p>
        </div>

        <!-- Grid -->
        <div id="resultsGrid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">
            <!-- JS Injection -->
        </div>

    </main>

    <script>
        // --- Configuration ---
        const GUIDES = [
            "Hyderali K", 
            "Balachandran K P", 
            "Geever C Zacharias", 
            "Vasudevan T V", 
            "Priya J D", 
            "Febin Aziz", 
            "Nowshad C V", 
            "C M Sulaikha"
        ];
        
        // --- Guide Short Codes Mapping ---
        const GUIDE_SHORT_CODES = {
            "Hyderali K": "HAK",
            "Balachandran K P": "KPB",
            "Geever C Zacharias": "GCZ",
            "Vasudevan T V": "VTV",
            "Priya J D": "PJD",
            "Febin Aziz": "FA",
            "Nowshad C V": "NCV",
            "C M Sulaikha": "CMS"
        };

        // --- STUDENT NAMES LIST (Populated from User Data) ---
        // Array index 0 matches Roll 1, index 59 matches Roll 60.
        // Roll 57 (index 56) is Excluded.
        const STUDENT_NAMES_LIST = [
            "ABDUL JANEEB K",        // 1
            "ADITHYA DAS MP",        // 2
            "AKHILA",                // 3
            "AMINA P M",             // 4
            "ANAN P ABBAS",          // 5
            "ANJU E",                // 6
            "ANSILA NV",             // 7
            "ATHILA ASHRAF",         // 8
            "AYISHA RANDHA",         // 9
            "BASIM SHEBIN",          // 10
            "DEVIKA S",              // 11
            "DILBUR ROSHAN MOHAMED", // 12
            "ESWARDAS K NAIR",       // 13
            "FASAL RAHMAN",          // 14
            "FATHIMATH MUHSINA T P", // 15
            "FATHIMATH SANA C V",    // 16
            "FATHIMATHUL HANNATH",   // 17
            "HANNA",                 // 18
            "HENNA FATHIMA",         // 19
            "HENNA FATHIMA K",       // 20
            "HIBA NASRIN",           // 21
            "JALALA P V",            // 22
            "JASIR HASSAN K",        // 23
            "JASNA SHERIN",          // 24
            "JYOTHISH MOHAN A",      // 25
            "K ANSAR",               // 26
            "LAKSHMI H",             // 27
            "MEGHNA P",              // 28
            "MOHAMMED HAFIZ",        // 29
            "MOHAMMED NIYAS",        // 30
            "MOHAMMED SHIBILY",      // 31
            "MUHAMMED FAZIL C",      // 32
            "MUHAMMED REJAH E",      // 33
            "MUHSEENA JAS P",        // 34
            "MUHSINA",               // 35
            "NAADHI RAHMAN P",       // 36
            "NAFEESA K T",           // 37
            "NAHEEL K K",            // 38
            "NAJMATH MV",            // 39
            "NASEEBA SALAHUDHEEN",   // 40
            "NAYANA U",              // 41
            "NIHAL N",               // 42
            "RAMSHIYA M S",          // 43
            "RIFA",                  // 44
            "RIZVANA K A",           // 45
            "ROSHNA SHIRIN M",       // 46
            "SAFA MARIYAM",          // 47
            "SAIFUDEEN",             // 48
            "SARAN S KRISHNAN",      // 49
            "SETHULAKSHMI K",        // 50
            "SHAHNA S",              // 51
            "SHIFANA NASRIN",        // 52
            "SHIMNA SHERIN",         // 53
            "SNEHA K P",             // 54
            "SOMIN KURIYAKOSE",      // 55
            "SOORAJ K P",            // 56
            "EXCLUDED (Roll 57)",    // 57 (Excluded in Logic)
            "SWAFWANA SHERI K P",    // 58
            "VAISHNAVI K",           // 59
            "YUSRA"                  // 60
        ];

        const TOTAL_ROLL_NUMBERS = 60;
        const EXCLUDED_ROLL = 57;

        // Generate student objects mapping Roll No (i+1) to Name
        const STUDENTS_DATA = Array.from({ length: TOTAL_ROLL_NUMBERS }, (_, i) => {
            const roll = i + 1;
            // Map index to name. Index 0 is Roll 1.
            const name = STUDENT_NAMES_LIST[i] || `Student Name ${roll}`;
            
            return {
                roll: roll,
                name: name
            };
        }).filter(s => s.roll !== EXCLUDED_ROLL);

        const HAK_COUNT = 6;
        const STANDARD_COUNT = 7;

        let currentAllocation = [];
        let isGenerating = false;

        function handleAllocate() {
            if (isGenerating) return;
            isGenerating = true;
            
            const btn = document.getElementById('allocateBtn');
            const btnText = document.getElementById('allocateBtnText');
            const icon = document.getElementById('btnIcon');
            
            btn.classList.add('opacity-75', 'cursor-wait');
            icon.classList.add('animate-spin');
            btnText.innerText = "Processing...";

            setTimeout(() => {
                const students = [...STUDENTS_DATA];

                // Fisher-Yates Shuffle
                for (let i = students.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [students[i], students[j]] = [students[j], students[i]];
                }

                // Distribution
                const newAllocation = GUIDES.map(guideName => ({ name: guideName, students: [] }));
                let studentPointer = 0;

                const assignToGuide = (name, count) => {
                    const targetGroup = newAllocation.find(g => g.name === name);
                    if (targetGroup) {
                        const takeCount = count === null ? (students.length - studentPointer) : count;
                        targetGroup.students = students.slice(studentPointer, studentPointer + takeCount);
                        studentPointer += takeCount;
                    }
                };

                // Assign HOD (Hyderali K)
                assignToGuide("Hyderali K", HAK_COUNT);
                
                // Assign Standard Count to others
                GUIDES.filter(t => t !== "Hyderali K" && t !== "Balachandran K P").forEach(guideName => {
                    assignToGuide(guideName, STANDARD_COUNT);
                });

                // Assign Remainder to Balachandran K P
                assignToGuide("Balachandran K P", null);

                // Sort by Roll No for display
                newAllocation.forEach(group => group.students.sort((a, b) => a.roll - b.roll));

                currentAllocation = newAllocation;
                renderResults();

                isGenerating = false;
                btn.classList.remove('opacity-75', 'cursor-wait');
                icon.classList.remove('animate-spin');
                btnText.innerText = "Re-Run Allocation";
                
                const dlBtn = document.getElementById('downloadBtn');
                dlBtn.classList.remove('hidden');
                dlBtn.classList.add('inline-flex');

            }, 600);
        }

        function renderResults() {
            const grid = document.getElementById('resultsGrid');
            const emptyState = document.getElementById('emptyState');
            
            emptyState.style.display = 'none';
            grid.innerHTML = '';

            currentAllocation.forEach((group, index) => {
                const isHOD = group.name === 'Hyderali K';
                
                let badge = isHOD 
                    ? `<span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-amber-500/10 text-amber-500 border border-amber-500/20 tracking-wide shrink-0">HOD</span>`
                    : `<span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium bg-zinc-800 text-zinc-400 border border-zinc-700 shrink-0">FACULTY</span>`;

                const borderColor = 'border-dark-700'; 
                const bgClass = 'bg-dark-800';

                // Display Roll No in Teal Box, Name next to it
                const studentsHtml = group.students.map(student => {
                    return `
                        <div class="flex items-center gap-3 p-2 rounded-lg bg-dark-900/50 border border-dark-700 hover:border-dark-600 transition-colors w-full">
                            <span class="flex items-center justify-center h-8 w-10 text-xs font-bold font-mono
                                bg-teal-950 text-teal-400 border border-teal-800 rounded
                                shadow-sm shadow-teal-900/20 shrink-0">
                                ${student.roll}
                            </span>
                            <span class="text-sm text-zinc-300 font-medium truncate min-w-0" title="${student.name}">
                                ${student.name}
                            </span>
                        </div>`;
                }).join('');
                
                // Use explicit short code mapping
                const initials = GUIDE_SHORT_CODES[group.name] || group.name.substring(0,2);

                const cardHtml = `
                    <div class="fade-in-up flex flex-col rounded-xl border ${borderColor} ${bgClass} shadow-lg group hover:border-dark-600 transition-colors duration-300 h-full" style="animation-delay: ${index * 50}ms">
                        <div class="p-5 border-b border-dark-700 flex items-start justify-between bg-white/5 gap-3">
                            <div class="flex items-center gap-3 min-w-0">
                                <div class="h-10 w-10 shrink-0 rounded-lg bg-dark-700 border border-dark-600 flex items-center justify-center font-heading font-bold text-white text-sm shadow-inner">
                                    ${initials}
                                </div>
                                <div class="flex flex-col min-w-0">
                                    <div class="flex flex-wrap items-center gap-2">
                                        <h3 class="font-heading font-semibold text-lg text-white leading-tight">${group.name}</h3>
                                        ${badge}
                                    </div>
                                </div>
                            </div>
                            <div class="flex flex-col items-end shrink-0">
                                <span class="text-2xl font-bold text-white leading-none">${group.students.length}</span>
                                <span class="text-[9px] text-zinc-400 uppercase font-medium">Students</span>
                            </div>
                        </div>
                        <div class="p-4 grow">
                            <div class="flex flex-col gap-2">
                                ${studentsHtml}
                            </div>
                        </div>
                    </div>
                `;
                
                grid.insertAdjacentHTML('beforeend', cardHtml);
            });
        }

        function handleDownloadPDF() {
            if (!window.jspdf || currentAllocation.length === 0) return;

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFont("helvetica", "bold");
            doc.setFontSize(16);
            doc.setTextColor(20, 20, 20);
            doc.text("MCA Project Guide Allocation", 14, 20);
            
            doc.setFont("helvetica", "normal");
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text(`Academic Year 2025-2026 • Generated ${new Date().toLocaleDateString()}`, 14, 26);

            doc.setDrawColor(230, 230, 230);
            doc.line(14, 32, 196, 32);

            // Table Data Construction
            const tableBody = [];
            const guideEndRowIndices = new Set();
            let rowIndex = 0;
            
            currentAllocation.forEach(group => {
                let guideName = group.name;
                if (group.name === 'Hyderali K') guideName += " (HOD)";
                
                const studentCount = group.students.length;

                group.students.forEach((student, index) => {
                    const row = [];
                    if (index === 0) {
                        // First row for this guide: Add the Guide Name cell with rowSpan
                        row.push({ 
                            content: guideName, 
                            rowSpan: studentCount,
                            styles: { valign: 'middle', fontStyle: 'bold', fillColor: [252, 252, 252] } 
                        });
                    }
                    // Add student details
                    row.push(student.roll);
                    row.push(student.name);
                    
                    tableBody.push(row);

                    // Track the last row index for this guide group
                    if (index === studentCount - 1) {
                        guideEndRowIndices.add(rowIndex);
                    }
                    rowIndex++;
                });
            });

            doc.autoTable({
                head: [['Guide', 'Roll No', 'Student Name']],
                body: tableBody,
                startY: 40,
                theme: 'grid', // Ensures separation lines
                styles: { 
                    fontSize: 9, 
                    cellPadding: 3, 
                    font: "helvetica",
                    lineColor: [60, 60, 60], // Dark gray grid lines for visibility
                    lineWidth: 0.1,
                    valign: 'middle',
                    textColor: [20, 20, 20]
                },
                headStyles: { 
                    fillColor: [40, 40, 40], // Dark header
                    textColor: [255, 255, 255],
                    fontStyle: 'bold',
                    lineWidth: 0.1,
                    lineColor: [60, 60, 60]
                },
                columnStyles: {
                    0: { cellWidth: 50 }, // Guide Name
                    1: { cellWidth: 20, halign: 'center', fontStyle: 'bold' }, // Roll
                    2: { cellWidth: 'auto' } // Name
                },
                didDrawCell: function(data) {
                    if (data.section === 'body') {
                        // Draw bold line at the bottom of the guide group
                        let drawBoldLine = false;

                        // For Guide Column (Col 0), it spans, so its bottom is always a separator
                        if (data.column.index === 0) {
                            drawBoldLine = true;
                        } 
                        // For Student Columns (Col 1, 2), check if it's the last row of a group
                        else if (guideEndRowIndices.has(data.row.index)) {
                            drawBoldLine = true;
                        }

                        if (drawBoldLine) {
                            const doc = data.doc;
                            doc.setDrawColor(0, 0, 0); // Black
                            doc.setLineWidth(0.5); // Thick bold line
                            doc.line(data.cell.x, data.cell.y + data.cell.height, data.cell.x + data.cell.width, data.cell.y + data.cell.height);
                        }
                    }
                }
            });

            doc.save("Guide_Allocation_2025-26.pdf");
        }
    </script>
</body>
</html>
